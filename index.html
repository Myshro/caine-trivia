<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CaineTrivia</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="header">
    <h1>Trivia Site</h1>
    <div class="header-controls">
      <div class="file-upload">
        <label for="file-input" class="file-label">
          Choose CSV File
        </label>
        <input type="file" id="file-input" accept=".csv">
      </div>
      <button class="shuffle-btn" id="shuffleButton" disabled>Shuffle Questions</button>
      <!-- <button class="image-test-btn" onclick="openImageTestModal()">Test Image</button> -->
    </div>
  </div>

  <!-- Image Test Modal -->
  <div class="modal" id="imageTestModal">
    <div class="modal-content">
      <div class="modal-header">Test Image URL</div>
      <div class="modal-input-group">
        <label for="imageUrlInput">Enter Image URL:</label>
        <input type="text" id="imageUrlInput" placeholder="https://example.com/image.jpg">
      </div>
      <div class="modal-buttons">
        <!-- <button onclick="testImage()">Test Image</button> -->
        <button onclick="closeImageTestModal()">Close</button>
      </div>
      <div class="test-image-preview">
        <img id="testImagePreview" alt="Test image">
        <div class="success" id="imageTestSuccess">✓ Image loaded successfully!</div>
        <div class="error" id="imageTestError">✗ Failed to load image. Please check the URL.</div>
      </div>
    </div>
  </div>

<img src="joeclose.jpg" alt="" style="position: fixed; top: 5%; left: 12%; width: 150px; opacity: 0.5; z-index: -1; transform: rotate(-15deg);">

<img src="joeclose.jpg" alt="" style="position: fixed; top: 18%; right: 8%; width: 120px; opacity: 0.5; z-index: -1; transform: rotate(22deg);">

<img src="joenormal.jpg" alt="" style="position: fixed; bottom: 30%; left: 45%; width: 180px; opacity: 0.5; z-index: -1; transform: rotate(8deg);">

<img src="joeclose.jpg" alt="" style="position: fixed; top: 40%; left: 5%; width: 100px; opacity: 0.5; z-index: -1; transform: rotate(-30deg);">

<img src="joenormal.jpg" alt="" style="position: fixed; bottom: 10%; right: 25%; width: 140px; opacity: 0.5; z-index: -1; transform: rotate(45deg);">

<img src="joeclose.jpg" alt="" style="position: fixed; top: 60%; right: 15%; width: 160px; opacity: 0.28; z-index: -1; transform: rotate(-10deg);">

<img src="joeclose.jpg" alt="" style="position: fixed; top: 25%; left: 30%; width: 110px; opacity: 0.7; z-index: -1; transform: rotate(18deg);">

<img src="joenormal.jpg" alt="" style="position: fixed; bottom: 45%; right: 40%; width: 130px; opacity: 0.3; z-index: -1; transform: rotate(-25deg);">

<img src="joeclose.jpg" alt="" style="position: fixed; top: 70%; left: 20%; width: 145px; opacity: 0.18; z-index: -1; transform: rotate(35deg);">

<img src="joeclose.jpg" alt="" style="position: fixed; top: 10%; left: 65%; width: 125px; opacity: 0.7; z-index: -1; transform: rotate(-5deg);">

<img src="joenormal.jpg" alt="" style="position: fixed; bottom: 20%; left: 10%; width: 155px; opacity: 0.8; z-index: -1; transform: rotate(12deg);">

<img src="joeclose.jpg" alt="" style="position: fixed; top: 85%; right: 35%; width: 115px; opacity: 0.32; z-index: -1; transform: rotate(-18deg);">
<p style="position: fixed; font-size: 10rem; top: 0%; left: 50%; transform: translateX(-50%) rotate(-18deg); opacity: 1; z-index: -1; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); animation: rainbow 2s infinite linear;">
  OUR BEAUTIFUL PRESIDENT
</p>


  <div class="main-container" id="mainContainer">
    <div class="split-container">
      <!-- Left Side - Question -->
      <div class="question-panel">
        <div class="panel-header">Question</div>
        <div class="content-wrapper">
          <div class="question" id="question"></div>
          <img id="qImage" class="question-image" style="display:none;">
        </div>
      </div>

      <!-- Right Side - Answer -->
      <div class="answer-panel">
        <div class="panel-header">Answer</div>
        <div class="content-wrapper">
          <img id="stateGif" class="state-gif" src="thinking.gif" style="display:none;">
          <div class="answer" id="answer" style="display:none;"></div>
          <img id="aImage" class="answer-image" style="display:none;">
          <div class="notes" id="notes" style="display:none;"></div>
        </div>
      </div>
    </div>

    <div class="controls-section">
      <div class="controls">
        <button id="prevButton" disabled>← Previous</button>
        <button id="revealButton" disabled>Reveal Answer</button>
        <button id="nextButton" disabled>Next →</button>
      </div>
      <div id="counter"></div>
      <!-- <div class="keyboard-hint">Use arrow keys (← →) to navigate, Space to reveal answer</div> -->
    </div>
  </div>

  <script>
    let questions = [];
    let currentIndex = 0;
    let answerRevealed = false;
    
    const ANSWER_STATES = { 
      "HIDDEN": "thinking.gif",
      "REVEALED": "answering.gif"
    };

    // Initialize
    document.getElementById('file-input').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        parseCSV(event.target.result);
      };
      reader.readAsText(file);
    });

    // Shuffle button event listener
    document.getElementById('shuffleButton').addEventListener('click', shuffleQuestions);

    // Image Test Modal Functions
    function openImageTestModal() {
      document.getElementById('imageTestModal').classList.add('active');
      document.getElementById('imageUrlInput').value = '';
      document.getElementById('testImagePreview').style.display = 'none';
      document.getElementById('imageTestSuccess').style.display = 'none';
      document.getElementById('imageTestError').style.display = 'none';
    }

    function closeImageTestModal() {
      document.getElementById('imageTestModal').classList.remove('active');
    }

    function testImage() {
      const url = document.getElementById('imageUrlInput').value.trim();
      if (!url) {
        alert('Please enter an image URL');
        return;
      }

      const img = document.getElementById('testImagePreview');
      const successMsg = document.getElementById('imageTestSuccess');
      const errorMsg = document.getElementById('imageTestError');

      // Reset states
      img.style.display = 'none';
      successMsg.style.display = 'none';
      errorMsg.style.display = 'none';

      // Create new image to test loading
      const testImg = new Image();
      testImg.onload = function() {
        img.src = url;
        img.style.display = 'block';
        successMsg.style.display = 'block';
      };
      testImg.onerror = function() {
        img.style.display = 'none';
        errorMsg.style.display = 'block';
      };
      testImg.src = url;
    }

    // Close modal when clicking outside
    document.getElementById('imageTestModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeImageTestModal();
      }
    });

    // Shuffle Questions Function
    function shuffleQuestions() {
      if (questions.length <= 1) return;
      
      // Fisher-Yates shuffle algorithm
      for (let i = questions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questions[i], questions[j]] = [questions[j], questions[i]];
      }
      
      // Reset to first question after shuffle
      currentIndex = 0;
      showQuestion();
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (questions.length === 0) return;
      
      // Don't trigger keyboard shortcuts when modal is open
      if (document.getElementById('imageTestModal').classList.contains('active')) return;
      
      switch(e.key) {
        case 'ArrowLeft':
          e.preventDefault();
          if (!document.getElementById('prevButton').disabled) {
            prevQuestion();
          }
          break;
        case 'ArrowRight':
          e.preventDefault();
          if (!document.getElementById('nextButton').disabled) {
            nextQuestion();
          }
          break;
        case ' ':
        case 'Space':
          e.preventDefault();
          if (!document.getElementById('revealButton').disabled) {
            toggleAnswer();
          }
          break;
      }
    });

    function splitCSV(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"') {
          if (inQuotes && line[i+1] === '"') {
            current += '"';
            i++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (char === ',' && !inQuotes) {
          result.push(current);
          current = '';
        } else {
          current += char;
        }
      }
      result.push(current);
      return result;
    }

    function parseCSV(csv) {
      const lines = csv.trim().split('\n');
      questions = lines.slice(1).map(line => {
        const values = splitCSV(line);
        return {
          question: values[0] || "",
          answer: values[1] || "",
          qImage: values[2] || "",
          aImage: values[3] || "",
          notes: values[4] || ""
        };
      });
      
      if (questions.length > 0) {
        document.getElementById('mainContainer').classList.add('active');
        document.getElementById('shuffleButton').disabled = false;
        enableControls();
        showQuestion();
      }
    }

    function enableControls() {
      document.getElementById('revealButton').disabled = false;
      document.getElementById('nextButton').disabled = false;
      
      document.getElementById('revealButton').addEventListener('click', toggleAnswer);
      document.getElementById('prevButton').addEventListener('click', prevQuestion);
      document.getElementById('nextButton').addEventListener('click', nextQuestion);
    }

    function showQuestion() {
      const q = questions[currentIndex];
      
      // Update question
      document.getElementById('question').textContent = q.question;
      
      // Update question image
      const qImg = document.getElementById('qImage');
      if (q.qImage) {
        qImg.style.display = 'block';
        qImg.src = q.qImage;
      } else {
        qImg.style.display = 'none';
      }
      
      // Hide answer initially
      hideAnswer();
      
      // Set answer content (but keep hidden)
      document.getElementById('answer').textContent = q.answer;
      document.getElementById('aImage').src = q.aImage;
      document.getElementById('notes').textContent = q.notes || "";
      
      // Update counter
      document.getElementById('counter').textContent = 
        `${currentIndex + 1} / ${questions.length}`;
      
      // Update button states
      document.getElementById('prevButton').disabled = currentIndex === 0;
      document.getElementById('nextButton').disabled = currentIndex === questions.length - 1;
      
      // Update reveal button text
      document.getElementById('revealButton').textContent = 'Reveal Answer';
      
      // Show thinking GIF
      showStateGif(ANSWER_STATES.HIDDEN);
    }

    function showStateGif(gifUrl) {
      const stateGif = document.getElementById('stateGif');
      stateGif.src = gifUrl;
      stateGif.style.display = 'block';
    }

    function hideAnswer() {
      answerRevealed = false;
      document.getElementById('answer').style.display = 'none';
      document.getElementById('aImage').style.display = 'none';
      document.getElementById('notes').style.display = 'none';
      showStateGif(ANSWER_STATES.HIDDEN);
    }

    function toggleAnswer() {
      const ansDiv = document.getElementById('answer');
      const aImg = document.getElementById('aImage');
      const notes = document.getElementById('notes');
      const revealBtn = document.getElementById('revealButton');
      const stateGif = document.getElementById('stateGif');
      
      if (!answerRevealed) {
        // Show answer
        ansDiv.style.display = 'block';
        if (questions[currentIndex].aImage) {
          aImg.style.display = 'block';
        }
        if (questions[currentIndex].notes) {
          notes.style.display = 'block';
        }
        stateGif.style.display = 'none';
        showStateGif(ANSWER_STATES.REVEALED);
        revealBtn.textContent = 'Hide Answer';
        answerRevealed = true;
      } else {
        // Hide answer
        hideAnswer();
        revealBtn.textContent = 'Reveal Answer';
      }
    }

    function prevQuestion() {
      if (currentIndex > 0) {
        currentIndex--;
        showQuestion();
      }
    }

    function nextQuestion() {
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        showQuestion();
      }
    }
  </script>
</body>
</html>